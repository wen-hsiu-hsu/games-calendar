# Calendar Scripts æ¶æ§‹èªªæ˜

æœ¬æ–‡ä»¶èªªæ˜ Sports Calendar Creator å¾Œç«¯æœå‹™çš„æ•´é«”æ¶æ§‹è¨­è¨ˆã€‚

## ç›®éŒ„

- [è¨­è¨ˆåŸå‰‡](#è¨­è¨ˆåŸå‰‡)
- [æ¶æ§‹æ¦‚è¦½](#æ¶æ§‹æ¦‚è¦½)
- [æ ¸å¿ƒè¨­è¨ˆæ¨¡å¼](#æ ¸å¿ƒè¨­è¨ˆæ¨¡å¼)
- [è³‡æ–™æµç¨‹](#è³‡æ–™æµç¨‹)
- [ç›®éŒ„çµæ§‹](#ç›®éŒ„çµæ§‹)

---

## è¨­è¨ˆåŸå‰‡

### é—œæ³¨é»åˆ†é›¢ (Separation of Concerns)

å°ˆæ¡ˆæ¡ç”¨æ¨¡çµ„åŒ–è¨­è¨ˆï¼Œå°‡ä¸åŒè·è²¬åˆ†é›¢ç‚ºç¨ç«‹å…ƒä»¶ï¼š

- **API Clients**: è² è²¬è³‡æ–™ç²å–
- **Adapters**: è² è²¬è³‡æ–™æ ¼å¼è½‰æ›
- **Data Processor**: è² è²¬è³‡æ–™è™•ç†èˆ‡åˆ†çµ„
- **Calendar Service**: è² è²¬ Google Calendar æ•´åˆ

### å¯æ“´å±•æ€§ (Extensibility)

- æ–°å¢é‹å‹•æ”¯æ´åªéœ€å¯¦ä½œå°æ‡‰çš„ Adapter
- ä½¿ç”¨ Factory Pattern å‹•æ…‹è¼‰å…¥é©é…å™¨
- ä¸å½±éŸ¿ç¾æœ‰åŠŸèƒ½

### å®¹éŒ¯æ€§ (Fault Tolerance)

- å–®ä¸€é‹å‹•å¤±æ•—ä¸å½±éŸ¿å…¶ä»–é‹å‹•è™•ç†
- èªè­‰å¤±æ•—æ™‚è¿”å› mock calendar IDï¼Œä¸ä¸­æ–·æœå‹™
- å®Œæ•´çš„éŒ¯èª¤è™•ç†èˆ‡æ—¥èªŒè¨˜éŒ„

---

## æ¶æ§‹æ¦‚è¦½

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          Entry Point                         â”‚
â”‚                      src/index.js                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â†“
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚         API Index Service           â”‚
         â”‚     utils/apiClient.js              â”‚
         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
         â”‚  â”‚ Static API   â”‚  BWF API    â”‚    â”‚
         â”‚  â”‚ (fetch)      â”‚ (Puppeteer) â”‚    â”‚
         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â†“
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚       Adapter Factory               â”‚
         â”‚   adapters/adapterFactory.js        â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â†“            â†“            â†“
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ BWF    â”‚  â”‚ Tennis  â”‚  â”‚ Other   â”‚
         â”‚Adapter â”‚  â”‚ Adapter â”‚  â”‚Adapters â”‚
         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
              â”‚           â”‚            â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚        Data Processor               â”‚
         â”‚    utils/dataProcessor.js           â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â†“
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚      Calendar Service               â”‚
         â”‚   services/calendarService.js       â”‚
         â”‚                                     â”‚
         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
         â”‚  â”‚   Google Calendar API        â”‚  â”‚
         â”‚  â”‚  - Auth (Service Account)    â”‚  â”‚
         â”‚  â”‚  - Create/Update Calendar    â”‚  â”‚
         â”‚  â”‚  - Create Events             â”‚  â”‚
         â”‚  â”‚  - Duplicate Prevention      â”‚  â”‚
         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## æ ¸å¿ƒè¨­è¨ˆæ¨¡å¼

### 1. Adapter Pattern

**ç›®çš„**: çµ±ä¸€ä¸åŒ API çš„è³‡æ–™æ ¼å¼

æ¯å€‹é‹å‹•å¯¦ä½œè‡ªå·±çš„ Adapterï¼Œå°‡åŸå§‹ API æ ¼å¼è½‰æ›ç‚ºæ¨™æº–æ ¼å¼ï¼š

```javascript
// å„ API åŸå§‹æ ¼å¼ä¸åŒ
BWF API    â†’ { results: [{month, tournaments: [...]}] }
Tennis API â†’ { events: [...] }
Other API  â†’ { data: {...} }

// é€é Adapter è½‰æ›ç‚ºçµ±ä¸€æ ¼å¼
â†“

æ¨™æº–æ ¼å¼ â†’ {
  id, name, location, dateStart, dateEnd,
  category, level, prize, url, description,
  source, lastUpdated
}
```

**å¯¦ä½œç¯„ä¾‹**:

```javascript
// adapters/bwfAdapter.js
export class BwfAdapter {
  standardize(data) {
    // å°‡ BWF æ ¼å¼è½‰æ›ç‚ºæ¨™æº–æ ¼å¼
    return standardizedData;
  }
}

// adapters/adapterFactory.js
const adapters = {
  'bwf': BwfAdapter,
  'tennis': TennisAdapter
};

export function getAdapter(sportId) {
  const AdapterClass = adapters[sportId];
  return AdapterClass ? new AdapterClass() : null;
}
```

---

### 2. Factory Pattern

**ç›®çš„**: å‹•æ…‹å»ºç«‹é©é…å™¨å¯¦ä¾‹

æ ¹æ“š `sportId` å‹•æ…‹æ±ºå®šä½¿ç”¨å“ªå€‹ Adapterï¼š

```javascript
// ä¸»æµç¨‹
const adapter = getAdapter('bwf');  // è¿”å› BwfAdapter å¯¦ä¾‹
const standardized = adapter.standardize(rawData);
```

**å„ªé»**:
- æ–°å¢é‹å‹•æ™‚åªéœ€è¨»å†Šåˆ° factory
- ä¸»æµç¨‹ä¸éœ€ä¿®æ”¹
- æ”¯æ´åŸ·è¡Œæ™‚æœŸæ±ºå®š

---

### 3. Service-Oriented Architecture

**ç›®çš„**: å°‡åŠŸèƒ½åˆ†é›¢ç‚ºç¨ç«‹æœå‹™

- **API Client Service**: è³‡æ–™ç²å–
- **Data Processing Service**: è³‡æ–™è™•ç†
- **Calendar Service**: æ—¥æ›†ç®¡ç†

æ¯å€‹ Service ç¨ç«‹é‹ä½œï¼Œé€éæ¨™æº–ä»‹é¢æºé€šã€‚

---

### 4. Strategy Pattern (ç”¨æ–¼ API Client)

**ç›®çš„**: æ ¹æ“šä¸åŒé‹å‹•ä½¿ç”¨ä¸åŒçš„è³‡æ–™ç²å–ç­–ç•¥

```javascript
// utils/apiClient.js
export async function fetchTournamentData(sportId) {
  // Strategy 1: BWF ä½¿ç”¨ Puppeteer
  if (sportId === 'bwf') {
    const client = new BwfApiClient();
    return await client.fetchTournaments();
  }

  // Strategy 2: å…¶ä»–é‹å‹•ä½¿ç”¨éœæ…‹ API
  const apiIndex = await fetchApiIndex();
  const api = apiIndex.apis.find(api => api.id === sportId);
  // ...
}
```

---

## è³‡æ–™æµç¨‹

### å®Œæ•´æµç¨‹

```
1. å•Ÿå‹•
   â””â”€ main(sportIds)

2. å°æ¯å€‹ sportId:
   â”œâ”€ ç²å– Adapter
   â”‚  â””â”€ getAdapter(sportId)
   â”‚
   â”œâ”€ ç²å–è³‡æ–™
   â”‚  â”œâ”€ BWF: BwfApiClient (Puppeteer)
   â”‚  â””â”€ å…¶ä»–: Static API (fetch)
   â”‚
   â”œâ”€ æ¨™æº–åŒ–è³‡æ–™
   â”‚  â””â”€ adapter.standardize(rawData)
   â”‚
   â”œâ”€ è™•ç†è³‡æ–™
   â”‚  â””â”€ processData(standardizedData)
   â”‚
   â””â”€ å»ºç«‹/æ›´æ–°æ—¥æ›†
      â”œâ”€ å–å¾—æˆ–å»ºç«‹æ—¥æ›†
      â”œâ”€ è¨­å®šå…¬é–‹æ¬Šé™
      â”œâ”€ å»ºç«‹äº‹ä»¶ï¼ˆé˜²é‡è¤‡ï¼‰
      â””â”€ è¿”å› Calendar ID
```

### éŒ¯èª¤è™•ç†

```
ä»»ä¸€é‹å‹•å¤±æ•— â†’ è¨˜éŒ„éŒ¯èª¤ â†’ ç¹¼çºŒè™•ç†ä¸‹ä¸€å€‹é‹å‹•
              â†“
           ä¸ä¸­æ–·æ•´é«”æµç¨‹
```

---

## ç›®éŒ„çµæ§‹

```
calendar-scripts/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ index.js              # ä¸»ç¨‹å¼å…¥å£
â”‚   â”‚
â”‚   â”œâ”€â”€ adapters/             # è³‡æ–™é©é…å™¨
â”‚   â”‚   â”œâ”€â”€ adapterFactory.js # Adapter å·¥å» 
â”‚   â”‚   â”œâ”€â”€ bwfAdapter.js     # BWF é©é…å™¨
â”‚   â”‚   â””â”€â”€ ...               # å…¶ä»–é‹å‹•é©é…å™¨
â”‚   â”‚
â”‚   â”œâ”€â”€ clients/              # API å®¢æˆ¶ç«¯
â”‚   â”‚   â”œâ”€â”€ bwfApiClient.js   # BWF Puppeteer Client
â”‚   â”‚   â””â”€â”€ ...               # å…¶ä»–å°ˆç”¨ Client
â”‚   â”‚
â”‚   â”œâ”€â”€ services/             # æœå‹™å±¤
â”‚   â”‚   â”œâ”€â”€ calendarService.js # Google Calendar æœå‹™
â”‚   â”‚   â””â”€â”€ authService.js     # èªè­‰æœå‹™
â”‚   â”‚
â”‚   â””â”€â”€ utils/                # å·¥å…·å‡½å¼
â”‚       â”œâ”€â”€ apiClient.js      # API ç²å–çµ±ä¸€ä»‹é¢
â”‚       â””â”€â”€ dataProcessor.js  # è³‡æ–™è™•ç†å·¥å…·
â”‚
â”œâ”€â”€ docs/                     # æ–‡ä»¶ç›®éŒ„
â”‚   â”œâ”€â”€ ARCHITECTURE.md       # æœ¬æ–‡ä»¶
â”‚   â”œâ”€â”€ DEVELOPMENT.md        # é–‹ç™¼æŒ‡å—
â”‚   â””â”€â”€ sports/               # å„é‹å‹•å°ˆå±¬æ–‡ä»¶
â”‚       â””â”€â”€ BWF.md            # BWF èªªæ˜
â”‚
â””â”€â”€ README.md                 # æ–‡ä»¶ç´¢å¼•
```

---

## æ¨™æº–è³‡æ–™æ ¼å¼

æ‰€æœ‰ Adapter å¿…é ˆè¼¸å‡ºæ­¤æ¨™æº–æ ¼å¼ï¼š

```typescript
interface Tournament {
  id: string;              // å”¯ä¸€è­˜åˆ¥ç¢¼
  name: string;            // è³½äº‹åç¨±
  location: {
    city: string;          // åŸå¸‚
    country: string;       // åœ‹å®¶
    venue: string;         // å ´é¤¨
  };
  dateStart: string;       // é–‹å§‹æ—¥æœŸ (ISO 8601)
  dateEnd: string;         // çµæŸæ—¥æœŸ (ISO 8601)
  category: string;        // è³½äº‹é¡åˆ¥
  level: string;           // ç­‰ç´š
  prize: string;           // çé‡‘
  url: string;             // å®˜æ–¹é€£çµ
  description: string;     // è©³ç´°æè¿°
  source: string;          // è³‡æ–™ä¾†æº
  lastUpdated: string;     // æœ€å¾Œæ›´æ–°æ™‚é–“ (ISO 8601)
}
```

---

## Google Calendar æ•´åˆ

### èªè­‰æ–¹å¼

ä½¿ç”¨ **Service Account** é€²è¡Œç„¡é ­èªè­‰ï¼š

```javascript
// å„ªé»
âœ“ ç„¡éœ€ä½¿ç”¨è€…äº’å‹•
âœ“ é©åˆ CI/CD ç’°å¢ƒ
âœ“ ç©©å®šå¯é 

// è¨­å®šéœ€æ±‚
- credentials.json (æœå‹™å¸³æˆ¶é‡‘é‘°)
- å°‡æœå‹™å¸³æˆ¶åŠ å…¥æ—¥æ›†å…±äº«
```

### æ™ºæ…§äº‹ä»¶åŒæ­¥æ©Ÿåˆ¶

æ¯æ¬¡åŸ·è¡Œæ™‚æœƒå®Œæ•´é©—è­‰æ‰€æœ‰äº‹ä»¶ï¼Œç¢ºä¿æ—¥æ›†èˆ‡ API è³‡æ–™åŒæ­¥ï¼š

#### åŒæ­¥ç­–ç•¥

```javascript
1. ç²å–æ—¥æ›†ä¸Šæ‰€æœ‰ç¾æœ‰äº‹ä»¶ï¼ˆæœªä¾†ä¸€å¹´ï¼‰
2. å»ºç«‹äº‹ä»¶æ˜ å°„è¡¨ï¼ˆkey: name|startDate|endDateï¼‰
3. å°æ¯å€‹ API è³½äº‹ï¼š
   â”œâ”€ äº‹ä»¶ä¸å­˜åœ¨ â†’ å»ºç«‹æ–°äº‹ä»¶
   â”œâ”€ äº‹ä»¶å·²å­˜åœ¨ä½†è³‡æ–™ä¸åŒ â†’ æ›´æ–°äº‹ä»¶
   â””â”€ äº‹ä»¶å·²å­˜åœ¨ä¸”è³‡æ–™ç›¸åŒ â†’ è·³é
4. åˆªé™¤æ—¥æ›†ä¸Šå·²ä¸å­˜åœ¨æ–¼ API çš„äº‹ä»¶
```

#### é©—è­‰æ¬„ä½

ç³»çµ±æœƒé©—è­‰ä»¥ä¸‹æ‰€æœ‰æ¬„ä½çš„è®Šæ›´ï¼š

```javascript
- summary (è³½äº‹åç¨±)
- location (åœ°é»)
- description (æè¿°)
- start.date / start.dateTime (é–‹å§‹æ™‚é–“)
- end.date / end.dateTime (çµæŸæ™‚é–“)
- source.url (å®˜æ–¹é€£çµ)
- transparency (é€æ˜åº¦)
- visibility (å¯è¦‹æ€§)
```

#### åŸ·è¡Œçµæœ

æ¯æ¬¡åŒæ­¥æœƒé¡¯ç¤ºè©³ç´°æ‘˜è¦ï¼š

```
ğŸ“Š Sync Summary for bwf:
   Created: 38      # æ–°å»ºç«‹çš„äº‹ä»¶
   Updated: 2       # è³‡æ–™æœ‰è®Šæ›´ï¼Œå·²æ›´æ–°
   Unchanged: 2     # è³‡æ–™å®Œå…¨ç›¸åŒï¼Œæœªè®Šæ›´
   Deleted: 2       # API å·²ç§»é™¤ï¼Œå¾æ—¥æ›†åˆªé™¤
   Total processed: 42
```

é€™ç¢ºä¿äº†ï¼š
- âœ… æ™‚é–“éŒ¯èª¤æœƒè‡ªå‹•ä¿®æ­£
- âœ… åœ°é»ã€æè¿°ç­‰è³‡è¨Šè®Šæ›´æœƒåŒæ­¥
- âœ… éæ™‚çš„è³½äº‹æœƒè¢«ç§»é™¤
- âœ… é¿å…é‡è¤‡å»ºç«‹ç›¸åŒäº‹ä»¶

---

## æ“´å±•æŒ‡å—

### æ–°å¢é‹å‹•æ”¯æ´

1. **å»ºç«‹ Adapter**
   ```javascript
   // src/adapters/tennisAdapter.js
   export class TennisAdapter {
     standardize(data) {
       // å¯¦ä½œè½‰æ›é‚è¼¯
       return standardizedData;
     }
   }
   ```

2. **è¨»å†Šåˆ° Factory**
   ```javascript
   // src/adapters/adapterFactory.js
   import { TennisAdapter } from './tennisAdapter.js';

   const adapters = {
     'bwf': BwfAdapter,
     'tennis': TennisAdapter  // æ–°å¢
   };
   ```

3. **å»ºç«‹å°ˆå±¬æ–‡ä»¶**
   ```bash
   # docs/sports/TENNIS.md
   ```

4. **(å¯é¸) å»ºç«‹å°ˆå±¬ Client**
   ```javascript
   // è‹¥éœ€è¦ç‰¹æ®Šè™•ç† (å¦‚ BWF éœ€è¦ Puppeteer)
   // src/clients/tennisApiClient.js
   ```

---

## åƒè€ƒæ–‡ä»¶

- [é–‹ç™¼æŒ‡å—](./DEVELOPMENT.md) - å¦‚ä½•é–‹ç™¼èˆ‡æ¸¬è©¦
- [BWF æ•´åˆèªªæ˜](./sports/BWF.md) - BWF ç‰¹å®šå¯¦ä½œ
- [å°ˆæ¡ˆ README](../README.md) - æ–‡ä»¶ç¸½ç´¢å¼•
